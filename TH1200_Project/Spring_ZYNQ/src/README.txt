FPGA 	VER: 1014

CPLD 	VER: 1001

LIB	VER: 6014

MOTION 	VER: 8018

标准项目号 BB016A004B

开发库版本：101

/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
特殊注意事项

1.....12轴标准弹簧机送线轴必须配置为第一个轴，6轴万能机送线轴必须配置为第2个轴 !!!!!!!!!!
2.....




!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
*/
加密狗加解密相关方法
/*
 * 当用户通过上位机进入加密狗设置界面时可通过 狗超级密码（116001），客户设定软件狗密码（Machine_Password），
 * 或者设定机器序列码（Machine_SerialNo）的算法操作得出的密码而进入加密狗设置界面
 */
 机器序列号算法为：输入数据的第11-20位与第1-10位互换 再减去130509 == Machine_SerialNo
#define SuperDogPassW  116001


//解当前期的限制的方法
1.直接输入当前期对应的正确密码
2.超级密码算法 DATA=(267*Dog.RandomNum)%1000000，即取低6位;  输入的数值==DATA即可解除当前期限制

权限管理相关方法
#define SuperPassword   691325//用户权限管理超级密码


标准项目号BB016A004B 注册码：0x04800081 通用型注册码0x00000000

程序信息
1> 探针信息
Open_probe//打开探针 打开后才能读取状态
read_probe//读取探针 读取的状态是记忆的，只有关掉探针才会清掉，例如读到打过探针状态后，当探针输入实际已经没有信号了
          //，但状态还是已打到探针的状态，只有关掉探针才会清除此状态。
close_probe//关掉探针，清除探针状态

FPGA中在打开对应探针后当读到对应探针输入端口有信号时，从该探针对应输出端口输出信号

探针输入
 32,33，34， 35号端口，用作探针输入端口， 对应探针1，探针2，探针3，探针4
 
 对应探针输出的三种方案
 1. 用对应脉冲端口的伺服清零输出点作为探针1号输出到探针6号输出，直接接到伺服的脉冲清零端口，来清掉滞后脉冲 前提是对应的轴为脉冲轴，
 	且伺服支持外部脉冲清零端口清零
 2. 用外部通用输出端口22,23号端口做探针7、探针8，对应输出端口，
 3. 暂未支持，
       只接探针输入，清零采用总线清零的方式，这部分工作由研发部来做。
       
       
2017.12.18 ===================================================
1>//金狮客户现场参数
	/*
	//金狮客户现场参数
	g_Sysparam.AxisParam[0].ScrewPitch=330.0;//送线轴螺距
	g_Sysparam.AxisParam[0].lHandSpeed=2500;//送线轴手动速度
	g_Sysparam.AxisParam[1].lHandSpeed=2000;//转芯轴手动速度
	g_Sysparam.AxisParam[2].lHandSpeed=200;//转线轴手动速度
	g_Sysparam.AxisParam[3].lHandSpeed=2500;//X1轴手动速度
	g_Sysparam.AxisParam[4].lHandSpeed=2500;//X2轴手动速度
	g_Sysparam.AxisParam[5].lHandSpeed=2500;//X3轴手动速度
	g_Sysparam.AxisParam[6].lHandSpeed=2500;//X4轴手动速度
	g_Sysparam.AxisParam[7].lHandSpeed=2500;//X5轴手动速度
	g_Sysparam.AxisParam[8].lHandSpeed=2500;//X6轴手动速度
	g_Sysparam.AxisParam[9].lHandSpeed=2500;//X7轴手动速度
	g_Sysparam.AxisParam[10].lHandSpeed=2500;//X8轴手动速度
	g_Sysparam.AxisParam[11].lHandSpeed=2500;//卷曲轴手动速度
	
	g_Sysparam.AxisParam[2].fBackSpeed=10;//转线轴归零速度
	
	g_Sysparam.AxisParam[0].fGearRate=6；//送线轴减速比
	g_Sysparam.AxisParam[1].fGearRate=5；//转芯轴减速比
	g_Sysparam.AxisParam[2].fGearRate=15；//转线轴减速比
	g_Sysparam.AxisParam[3].fGearRate=7；//X1轴减速比
	g_Sysparam.AxisParam[4].fGearRate=7；//X2轴减速比
	g_Sysparam.AxisParam[5].fGearRate=7；//X3轴减速比
	g_Sysparam.AxisParam[6].fGearRate=7；//X4轴减速比
	g_Sysparam.AxisParam[7].fGearRate=7；//X5轴减速比
	g_Sysparam.AxisParam[8].fGearRate=7；//X6轴减速比
	g_Sysparam.AxisParam[9].fGearRate=7；//X7轴减速比
	g_Sysparam.AxisParam[10].fGearRate=7；//X8轴减速比
	g_Sysparam.AxisParam[11].fGearRate=25；//卷曲轴减速比
	
	
	g_Sysparam.AxisParam[0].iRunDir=0；//送线轴运行方向
	g_Sysparam.AxisParam[1].iRunDir=0；//转芯轴运行方向
	g_Sysparam.AxisParam[2].iRunDir=0；//转线轴运行方向
	g_Sysparam.AxisParam[3].iRunDir=1；//X1轴运行方向
	g_Sysparam.AxisParam[4].iRunDir=1；//X2轴运行方向
	g_Sysparam.AxisParam[5].iRunDir=1；//X3轴运行方向
	g_Sysparam.AxisParam[6].iRunDir=1；//X4轴运行方向
	g_Sysparam.AxisParam[7].iRunDir=1；//X5轴运行方向
	g_Sysparam.AxisParam[8].iRunDir=1；//X6轴运行方向
	g_Sysparam.AxisParam[9].iRunDir=1；//X7轴运行方向
	g_Sysparam.AxisParam[10].iRunDir=1；//X8轴运行方向
	g_Sysparam.AxisParam[11].iRunDir=1；//卷曲轴运行方向

	g_Sysparam.AxisParam[0].AxisNodeType=41；//送线轴伺服类型 三洋伺服
	g_Sysparam.AxisParam[1].AxisNodeType=41；//转芯轴伺服类型
	g_Sysparam.AxisParam[2].AxisNodeType=41；//转线轴伺服类型
	g_Sysparam.AxisParam[3].AxisNodeType=41；//X1轴伺服类型
	g_Sysparam.AxisParam[4].AxisNodeType=41；//X2轴伺服类型
	g_Sysparam.AxisParam[5].AxisNodeType=41；//X3轴伺服类型
	g_Sysparam.AxisParam[6].AxisNodeType=41；//X4轴伺服类型
	g_Sysparam.AxisParam[7].AxisNodeType=41；//X5轴伺服类型
	g_Sysparam.AxisParam[8].AxisNodeType=41；//X6轴伺服类型
	g_Sysparam.AxisParam[9].AxisNodeType=41；//X7轴伺服类型
	g_Sysparam.AxisParam[10].AxisNodeType=41；//X8轴伺服类型
	g_Sysparam.AxisParam[11].AxisNodeType=41；//卷曲轴伺服类型
	
	
	AzParam.LIMITConf //转线轴正负硬限位使能 1
	
	
	g_Sysparam.InConfig[Y_HOME].IONum = 9;//转芯原点
	g_Sysparam.InConfig[Z_HOME].IONum = 10;//转线原点
	X1-X8原点对应1-8；
	J1轴原点11；
	转线轴正限位 12号
	转线轴负限位 13号
	缠线报警 15，断线跑线都不配置
	
	
	......
	......
	......
	 */

2>更改轴加工完后回零模式iBackMode
的自理处理，该参数更改后数据需要重新解析

171222
1>更改手摇轮摇动时速度不能实时改变问题原因是，走的时候没用continue_move函数是用Pmove函数，只有用continue_move函数才可以实时更改速度
2〉更改参数更改后都需要重新做数据解析
3>增加在加工状态下进入测试模式需要把倍率设为0,同时加工状态改为暂停状态
4>增加剪线功能,同时增加工作状态 剪线工作状态和退刀工作状态
5>更改在第一行编M指令探针行时,同时编有气缸输出的情况下,气缸不关闭的Bug.

171224
1.更改在如果一个轴在多圈模式下或加工完回零的模式下机械回零后如果轴有运动后按单条键会提示归零失败的BUg。
2.更改归零失败后不能查到最新的导致归零失败的信息的BUG。
3.增加S指令速度百分比处理。

???问号表示待解决的问题
171225
1.探针次数与目标产量显示乱值需要查明处理,查找中??????  已解决   在创建文件的时候需要把文件头的信息进行初始化再保存

171228
1.增加在主界面增加仿真测试旋钮进行测试加工的功能，更改中
171229
1.更改探针行关闭上一行气缸为关闭当前行气缸，原因：之前9100沿用以前开始角和结束角编程的方式，因为以前开始角和结束角解析时是分别解析的，
开始角和结束角会各自解析成一行数据，所以关闭气缸关闭的的是开始角的气缸，即上一行气缸，现在解析只有一行数据，所以关闭当前行数据编的气缸即可。

18.1.4
1.把产品参数保存由之前的文件系统保存改为保存在铁电中

18.1.5
1.增加FTP功能
2.更改在USB连接状态，手摇在使能状态，摇手摇后，当USB连接停止后选中的轴会动的BUG（原因：手摇后由于手盒是使能的，当状态改为停止后
由于手轮编码器脉冲没有清掉，手盒又是使能的，则立即会进入手摇轴动，从而导致选中的轴会动）。

18.1.16
1.更改文件因格式不对读取出错时，此时把铁电中存储的文件路径初始化，更改读取的文件，防止上位机把读出错的源文件覆盖

18.2.6
1.更改在自动运行加工情况下，测试旋钮旋到100时测试加工不运行的BUG
2.增加多轴顺序可配置同时归零，同时可兼容以前的多轴顺序单独归零模式，在参数中增加归零模式参数可配置该模式
3.解决测试加工模式下，加工剩余时间不刷新的BUG

18.2.7
1.把加密狗数据的读取改到modbus任务启动前，以解决上位机启动后可能由于在设置伺服等动作的延误后读取到未知的加密狗数据，
导致需要在加密狗无限制的情况下需要去解密的BUG。

18.2.26
1. 修改正负硬限位参数使用同一个参数导致上位机显示状态不对的BUG，现在正负硬限位分开记录，不使用以前的按位表达

18.2.27
1.修改原来的测试旋钮百分比下次开机不保存状态为保存状态，达到全真模拟机械测试旋钮

18.3.8
1.更改原点偏移量之前只支持正值偏移的BUG,现在正负值都可以
2.更改运动中编程IO映射
3.更改手盒急停由之前的在手盒使能情况下有效改为任何状态下有效

18.3.9
1.在加工前如果手动移动过该轴，那相应轴加工前需要回程序零点
//2.在RunEnd 函数中增加所有气缸加工完后关闭
3.更改加工完后手盒使能要强制关掉,防止手摇加工完后选中的轴此时继续手摇 会动 
4.增加手盒教导按键检测功能,同时增加参数配合教导功能分整行教导和单轴教导

18.4.1
1.更改IO备份按IO名字备份改为按功能号备份

18.4.17
1.增加IO到位等待功能，探针大于4的值编为外部IO输入等待，同时把当前行的延时作为该行输入等待超时时间。如要编延时可另起一行编延时。

18.4.25
1.增加万能机机器类型的选择，同时升级相应代码，配套万能机的功能，万能机为带有起始角和结束角的机型
2.12轴标准弹簧机送线轴必须配置为第一个轴，6轴万能机送线轴必须配置为第2个轴  （注意！）


18.5.16
1.把在12轴标准弹簧机上的 上下位机通信成功 校验功能  移植过来
2.把在12轴标准弹簧机上的 加密狗2同时兼容加密狗1的 通用型加密狗移植过来
3.更改在文件中添加输出不起作用的BUG

18.08.31
1.同步更新标准机上功能
	1>根据有刚设备更改外部运行灯指示，在运行状态下运行灯输出打开，其余状态下关闭。
	2>报警灯输出由之前的系统内部间隔50ms间隔开启闪烁输出改为长输出，因为一旦报警只要给到外部报警灯信号，外部报警灯会自行闪烁鸣叫。
	3>根据有刚设备更改按归零键，在报警已排除的情况下，进行报警信息清除。
	4>根据洪永助意见将IO输入默认值初始化为控制器上已有输入，IO输出默认值初始化为控制器上已有输出
	5>根据洪永助意见将IO诊断界面重新排序。

19.02.27
1.应当在手轮轴动和软件轴动正向运动时,清除负硬件限位和负软件限位报警,在负向运动时,清除正硬件限位报警和正软件限位报警.
2.增加自定义读写FIFO MODBUS功能
3.增加了强制机械归零功能
4.根据银丰要求增加转线时送线补偿功能

19.03.18
1.更改解析数据任务，轴运动类型判别变量错误的问题

19.03.19
1.更改解析任务中，延时列变量记错到输出列的错误

19.03.19（包带机特有功能增加）
1.增加工艺参数中包带机工艺使能参数
2.增加包带机安全门检测，碰撞检测报警功能
3.增加外部暂停按钮，该功能键值直接接测试按钮功能
4.增加超时报警暂停功能，重新按启动按键继续加工，会重新去检测该IO。
5.增加两路归零前的确认输入信号（用来确认在归零安全区域）
